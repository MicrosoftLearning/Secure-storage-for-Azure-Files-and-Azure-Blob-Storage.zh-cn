---
lab:
  title: 练习 02a：为公共网站提供存储
  module: Guided Project - Azure Files and Azure Blobs
---


公司网站提供产品图像、视频、营销资料和客户成功案例。 客户遍布全球，需求不断迅速扩大。 内容是任务关键型内容，需要低延迟加载时间。 必须跟踪文档版本，并在文档被删除时快速还原文档，这一点非常重要。

## 体系结构关系图

![显示一个存储帐户和一个 blob 容器的示意图。](../Media/task-2.png)

## 技能任务
- 创建具有高可用性的存储帐户。
- 确保存储帐户具有匿名公共访问权限。
- 为网站文档创建 Blob 存储容器。
- 启用软删除，以便可以轻松还原文件。
- 启用 Blob 版本控制。 


## 练习说明

## 创建具有高可用性的存储帐户。

1. 创建存储帐户以支持公共网站。

    - 在门户中，搜索并选择 `Storage accounts`。  
    - 选择“+ 新建”。 
    - 对于“资源组”****，选择“新建”****。 设定资源组的“名称”****，并选择“确定”****。 
    - 将“存储帐户名称”**** 设置为 `publicwebsite`。 通过添加标识符，确保存储帐户名称是唯一的。
    - 对于其他设置，采用默认值。 
    - 选择“查看”，然后选择“创建”********。
    - 等待存储帐户部署完成，然后选择“转到资源”****。
         
1. 如果发生区域性中断，此存储需要高可用性。 此外，启用对次要区域的读取访问权限，详细了解[存储帐户冗余](https://learn.microsoft.com/azure/storage/common/storage-redundancy#geo-redundant-storage)。

    - 在“存储帐户”的“数据管理”**** 部分中，选择“冗余”**** 边栏选项卡。 
    - 确保已选择“读取访问异地冗余存储”****。
    - 查看主要位置和次要位置信息。 

1. 客户应无需登录即可访问公共网站上的信息。
    - 在“存储帐户”的“设置”**** 部分中，选择“配置”**** 边栏选项卡。
    - 确保“允许 Blob 匿名访问”**** 设置为“已启用”****。
    - 务必保存你的更改。 
  
   
## 创建具有匿名读取访问权限的 Blob 存储容器

1. 公共网站具有多种图像和文档。 为内容创建 Blob 存储容器。 了解有关[存储容器](https://learn.microsoft.com/azure/storage/blobs/storage-blobs-introduction#containers)的更多信息。
    - 在“存储帐户”的“数据存储”**** 部分中，选择“容器”**** 边栏选项卡。 
    - 选择“+ 容器”。 
    - 确保容器的“名称”**** 是 `public`。 
    - 选择**创建**。 
    
1. 客户应该能够在无需经过身份验证的情况下查看图像。 为公共容器 Blob 配置匿名读取访问权限。  详细了解[配置匿名公共访问](https://learn.microsoft.com/azure/storage/blobs/anonymous-read-access-configure?tabs=portal)。
    - 选择“公共”容器****。 
    - 在“概述”边栏选项卡中，选择“更改访问级别”********。 
    - 确保“公共访问级别”为“Blob (仅限 Blob 的匿名读取访问)”********。
    - 选择“确定”****。 

## 练习上传文件和测试访问权限。

1. 为进行测试，上传一个文件到公共**** 容器。 文件类型并不重要。 小型图像或文本文件是不错的选择。  
    - 确保查看容器。 
    - 选择**上载**。 
    - 浏览到文件**** 并选择文件。 浏览到所选文件。 
    - 选择**上载**。
    - 关闭上传窗口，“刷新”**** 页面并确保文件已上传。 

1. 确定已上传文件的 URL。 打开浏览器并测试 URL。 
    - 选择上传的文件。
    - 在“概述”选项卡上，复制 URL********。
    - 将 URL 粘贴到新的浏览器选项卡中。
    - 如果上传的是图像文件，它将在浏览器中显示。 如果是其他类型的文件，则应当会进行下载。 

## 配置软删除

1. 删除的网站文档必须可以还原，这一点很重要。 配置 21 天的 Blob 软删除。 详细了解 [Blob 软删除](https://learn.microsoft.com/azure/storage/blobs/soft-delete-container-enable?tabs=azure-portal)。
    - 转到“存储帐户”**** 的“概述”**** 边栏选项卡。
    - 在“属性”**** 页上，找到“Blob 服务”**** 部分。
    - 选择“Blob 软删除”**** 设置。
    - 确保已选中****“启用 Blob 软删除”****。
    - 将“保留已删除的 Blob (以天为单位)”**** 设置更改为 21****。
    - 请注意，还可以为容器启用软删除****。 
    - 切勿忘记保存更改****。 

1. 如果某些内容已删除，则需要练习使用软删除来还原文件。
    - 导航到在其中上传了文件的容器。
    - 选择上传的文件，然后选择“删除”****。
    - 选择“确定”**** 以确认删除文件。  
    - 在容器“概述”页上，将滑块切换为“显示已删除的 Blob”********。 此切换开关位于搜索框右侧。 
    - 选择已删除的文件，并使用最右侧的省略号取消删除文件****。 
    - 刷新容器并确认文件已还原。     

## 配置 Blob 版本控制
1. 请务必跟踪不同的网站产品文档版本。 详细了解 [Blob 版本控制](https://learn.microsoft.com/azure/storage/blobs/versioning-enable?tabs=portal)。
    - 转到“存储帐户”**** 的“概述”**** 边栏选项卡。
    - 在“属性”**** 部分中，找到“Blob 服务”**** 部分。
    - 选择“版本控制”**** 设置。
    - 确保选中“为 Blob 启用版本控制”**** 复选框。
    - 请注意“保留所有版本”**** 或“一段时候后删除版本”**** 的选项。 
    - 切勿忘记保存更改****。 

1. 如果你有时间，可尝试恢复之前的 Blob 版本。
   - 上传**** 另一版本的容器文件。 这会覆盖现有文件。 
   - 上一个文件版本会在“显示已删除的 Blob”**** 页上列出。 
    

